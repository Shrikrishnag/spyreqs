!function(e){"use strict";function t(e){var t=new $.Deferred;return y.executeAsync({url:e,method:"GET",dataType:"json",headers:{Accept:"application/json;odata=verbose"},success:function(e){t.resolve(JSON.parse(e.body))},fail:function(e){t.reject(e)}}),t.promise()}function n(e){var t=new $.Deferred;return y.executeAsync({url:e,method:"GET",success:function(e){t.resolve(e.body)},fail:function(e){t.reject(e)}}),t.promise()}function r(e,t){var n=new $.Deferred;return y.executeAsync({url:e,method:"POST",headers:{Accept:"application/json; odata=verbose"},contentType:"application/json;odata=verbose",body:t,success:function(e){n.resolve(JSON.parse(e.body))},fail:function(e){n.reject(e)}}),n.promise()}function i(e,t){var n=new $.Deferred;return y.executeAsync({url:e,method:"POST",headers:{ACCEPT:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose"},contentType:"application/json;odata=verbose",body:JSON.stringify(t),success:function(e){n.resolve(JSON.parse(e.body))},fail:function(e){n.reject(e)}}),n.promise()}function o(e,t){var n=new $.Deferred;return y.executeAsync({url:e,method:"POST",headers:{Accept:"application/json;odata=verbose","X-HTTP-Method":"DELETE","If-Match":t?t:"*"},success:function(e){n.resolve(e)},fail:function(e){n.reject(e)}}),n.promise()}function s(e,t){var n=new $.Deferred;return y.executeAsync({url:e,method:"POST",body:JSON.stringify(t),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-HTTP-Method":"MERGE","If-Match":t.__metadata&&t.__metadata.etag?t.__metadata.etag:"*"},success:function(e){n.resolve(e)},fail:function(e){n.reject(e)}}),n.promise()}function a(e,t){var n=new $.Deferred;return y.executeAsync({url:e,method:"POST",body:JSON.stringify(t),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose"},success:function(e){n.resolve(JSON.parse(e.body))},fail:function(e){n.reject(e)}}),n.promise()}function c(e){return"undefined"!=typeof e&&("string"==typeof e||e instanceof String)?e:""}function u(){var e,t,n,r={};return SP.ClientContext?(e=new SP.ClientContext(v),t=new SP.ProxyWebRequestExecutorFactory(v),e.set_webRequestExecutorFactory(t),n=new SP.AppContextSite(e,g),r.context=e,r.factory=t,r.appContextSite=n,r):(x("SP.ClientContext not loaded"),null)}function l(){var e,t={};return SP.ClientContext?(e=new SP.ClientContext(v),t.context=e,t.appContextSite=e,t):(x("SP.ClientContext not loaded"),null)}function d(){if(e.location.search){for(var t,n=document.location.search.substring(1).split("&"),r=n.length,i={},o=0;r>o;o++)t=n[o].toString().split("="),i[t[0]]=t[1];return i}return{}}function f(e,t,n){var r=e.indexOf("?");if(r>-1){for(var i=e.substring(r+1).split("&"),o={},s=i.length,a=0;s>a;a++){var c=i[a].toString().split("=");o[c[0]]=c[1]}o[t]=n;var u="?";for(var l in o)u+=l+"="+o[l]+"&";return u=u.substr(0,u.length-1),String(e.substr(0,r)+u)}return String(e+"?"+t+"="+n)}function p(e,t){var n,r;return t.forEach(function(t){n=Object.keys(e[t]),n.forEach(function(n){-1!==n.indexOf("App")&&(r=n.replace("App","Web"),e[t][r]=e[t][n])})}),e}var v,g,m,y,b,w,x,L,S,T,_=0,A="0.0.7";if(x="undefined"!=typeof e.console?function(t){e.console.log(t)}:"undefined"!=typeof e.top&&"undefined"!=typeof e.top.console?function(t){e.top.console.log(t)}:"undefined"!=typeof e.opener&&"undefined"!=typeof e.opener.console?function(t){e.opener.console.log(t)}:function(){},m=d(),"undefined"!=typeof m.SPAppWebUrl?(v=decodeURIComponent(m.SPAppWebUrl),-1!==v.indexOf("#")&&(v=v.split("#")[0])):_++,"undefined"!=typeof m.SPHostUrl?(g=decodeURIComponent(m.SPHostUrl),w="&@target='"+g+"'",b=v+"/_api/SP.AppContextSite(@target)/",y=new SP.RequestExecutor(v)):_++,2==_){var h=e.location.href;v=g=h.substring(0,h.indexOf("/Pages")),$.getScript(g+"/_layouts/15/SP.RequestExecutor.js").done(function(){x("loaded: RequestExecutor.js"),y=new SP.RequestExecutor(g)}).fail(function(){x("could not load: RequestExecutor.js")}),SP.ClientContext?x("sp.js is already loaded"):SP.SOD.executeFunc("sp.js","SP.ClientContext.get_current",function(){x("loaded: sp.js")})}else 1==_&&x("query param (SPHostUrl or SPAppWebUrl) is misssing");L={createList:function(e,t){var n={__metadata:{type:"SP.List"},BaseTemplate:t.Template,Title:t.Title};return a(e,n)},addListField:function(e,t,n){return t.__metadata={type:"undefined"!=typeof n?n:"SP.Field"},a(e,t)}},S={createListFields:function(e,t,n){function r(){var n,r,u;if("undefined"==typeof a&&(a=new $.Deferred),"undefined"==typeof s.Type&&(s.Type="Text"),"undefined"==typeof s.DisplayName&&(s.DisplayName=s.Name),"Lookup"!==s.Type){n="<Field ";for(u in s)"choices"!==u&&(n+=u+'="'+s[u]+'" ');if(n+=">","Choice"===s.Type){n+="<CHOICES>";for(r in s.choices)n+="<CHOICE>"+s.choices[r]+"</CHOICE>";n+="</CHOICES>"}n+="</Field>"}else n+="";c=t.get_fields().addFieldAsXml(n,!0,SP.AddFieldOptions.defaultValue),e.load(t),e.executeQueryAsync(i,o)}function i(){n.length>0?(s=n.shift(),r()):a.resolve(c)}function o(e,t){var n={sender:e,args:t};a.reject(n)}var s,a,c;return s=n.shift(),r(),a.promise()},createList:function(e,t){function n(){t.fields?$.when(S.createListFields(e.context,o,t.fields)).then(function(){l.resolve(t)},function(e){l.reject(e)}):l.resolve(t)}function r(e,t){var n={sender:e,args:t};l.reject(n)}var i,o,s,a,c,u,l=new $.Deferred,d=["contentTypesEnabled","defaultContentApprovalWorkflowId","defaultDisplayFormUrl","defaultEditFormUrl","defaultNewFormUrl","documentTemplateUrl","draftVersionVisibility","enableAttachments","enableFolderCreation","enableMinorVersions","enableModeration","enableVersioning","forceCheckout","hidden","isApplicationList","isSiteAssetsLibrary","multipleDataList","noCrawl","onQuickLaunch","validationFormula","validationMessage","direction"];if(i=e.appContextSite.get_web(),s=new SP.ListCreationInformation,"undefined"==typeof t.title){x("createList cannot create without .title");var f={get_message:function(){return"createList cannot create without .title"},get_stackTrace:function(){return null}};return setTimeout(r(null,f),500),l.promise()}s.set_title(t.title),a="undefined"==typeof t.template?SP.ListTemplateType.genericList:isNaN(t.template)?SP.ListTemplateType[t.template]:t.template,s.set_templateType(a);for(var p in t)c=t[p],u="set_"+p,"function"==typeof s[u]&&s[u](c);o=i.get_lists().add(s);for(var p in t)c=t[p],u="set_"+p,d.indexOf(p)>-1&&o[u](c);return o.update(),e.context.load(o),e.context.executeQueryAsync(n,r),l.promise()},addListItem:function(e,t,n){function r(){l.resolve(a.get_id())}function i(e,t){var n={sender:e,args:t};l.reject(n)}var o,s,a,c,u,l=new $.Deferred;o=e.appContextSite.get_web(),s=o.get_lists().getByTitle(t),u=new SP.ListItemCreationInformation,a=s.addItem(u);for(c in n)a.set_item(c,n[c]);return a.update(),e.context.load(a),e.context.executeQueryAsync(r,i),l.promise()},getItems:function(e,t,n){function r(){c.resolve(a)}function i(e,t){var n={sender:e,args:t};c.reject(n)}var o,s,a,c=new $.Deferred;o=e.appContextSite.get_web(),s=o.get_lists().getByTitle(t);var u=new SP.CamlQuery;return u.set_viewXml(n),a=s.getItems(u),e.context.load(a),e.context.executeQueryAsync(r,i),c.promise()},updateListItem:function(e,t,n,r){function i(){l.resolve(r)}function o(e,t){var n={sender:e,args:t};l.reject(n)}var s,a,c,u,r,l=new $.Deferred;s=e.appContextSite.get_web(),a=s.get_lists().getByTitle(t),c=a.getItemById(r);for(u in n)c.set_item(u,n[u]);return c.update(),e.context.load(c),e.context.executeQueryAsync(i,o),l.promise()},checkList:function(e,t){function n(){for(var e=!1,n=o.getEnumerator();n.moveNext();){var r=n.get_current();if(r.get_title()==t){e=!0;break}}x(e),s.resolve(e)}function r(e,t){var n={sender:e,args:t};s.reject(n)}var i,o,s=new $.Deferred;if(!e){var a={get_message:function(){return"SP.ClientContext not loaded"},get_stackTrace:function(){return null}};return setTimeout(r(null,a),500),s.promise()}return i=e.appContextSite.get_web(),o=i.get_lists(),e.context.load(o,"Include(Title)"),e.context.executeQueryAsync(n,r),s.promise()},removeRecentElemByTitle:function(e,t){function n(){var e="element removed from Recent";o.resolve(e)}function r(e,t){var n={sender:e,args:t};o.reject(n)}var i=e.appContextSite.get_web().get_navigation().get_quickLaunch(),o=new $.Deferred;return e.context.load(i),e.context.executeQueryAsync(function(){for(var o,s=i.getEnumerator();s.moveNext();)if(o=s.get_current(),"Recent"==o.get_title()){var a=o.get_children();e.context.load(a),e.context.executeQueryAsync(function(){for(var o,s=a.getEnumerator(),c=!1;s.moveNext();)if(o=s.get_current(),o.get_title()==t){c=!0,o.deleteObject(),e.context.load(i),e.context.executeQueryAsync(n,r);break}if(!c){var u={get_message:function(){return"Element was not found"},get_stackTrace:function(){return null}};setTimeout(r(null,u),500)}},r)}},r),o.promise()},getList:function(e,t){function n(){s.resolve(o)}function r(e,t){var n={sender:e,args:t};s.reject(n)}var i,o,s=new $.Deferred;return i=e.appContextSite.get_web(),o=i.get_lists().getByTitle(t),e.context.load(o),e.context.executeQueryAsync(n,r),s.promise()},deleteList:function(e,t){function n(){s.resolve(t+" deleted")}function r(e,t){var n={sender:e,args:t};s.reject(n)}var i,o,s=new $.Deferred;return i=e.appContextSite.get_web(),o=i.get_lists().getByTitle(t),o.deleteObject(),e.context.executeQueryAsync(n,r),s.promise()},getListPermissions:function(e,t,n){function r(){c.resolve(a)}function i(e,t){var n={sender:e,args:t};c.reject(n)}var o,s,a,c=new $.Deferred;return o=e.appContextSite.get_web(),s=o.get_lists().getByTitle(t),a=s.getUserEffectivePermissions(n),e.context.load(s,"EffectiveBasePermissions"),e.context.executeQueryAsync(r,i),c.promise()}},T={rest:{getHostLists:function(e){var n=b+"web/lists?"+c(e)+w;return t(n)},getAppLists:function(e){var n=v+"/_api/web/lists?"+c(e);return t(n)},getHostListByTitle:function(e,n){var r=b+"web/lists/getByTitle('"+e+"')?"+c(n)+w;return t(r)},getAppListByTitle:function(e,n){var r=v+"/_api/web/lists/getByTitle('"+e+"')?"+c(n);return t(r)},getHostListItems:function(e,n){var r=b+"web/lists/getByTitle('"+e+"')/Items?"+c(n)+w;return t(r)},getAppListItems:function(e,n){var r=v+"/_api/web/lists/getByTitle('"+e+"')/Items?"+c(n);return t(r)},getHostListFields:function(e,n){var r=b+"web/lists/getByTitle('"+e+"')/Fields?"+c(n)+w;return t(r)},getAppListFields:function(e,n){var r=v+"/_api/web/lists/getByTitle('"+e+"')/Fields?"+c(n);return t(r)},createHostList:function(e){var t=b+"web/lists?"+w;return L.createList(t,e)},createAppList:function(e){var t=v+"/_api/web/lists?";return L.createList(t,e)},addHostListItem:function(e,t){var n=b+"web/lists/getByTitle('"+e+"')/Items?"+w;return a(n,t)},addAppListItem:function(e,t){var n=v+"/_api/web/lists/getByTitle('"+e+"')/Items?";return a(n,t)},deleteHostListItem:function(e,t,n){var r=b+"web/lists/getByTitle('"+e+"')/Items("+t+")?"+w;return o(r,n)},deleteAppListItem:function(e,t,n){var r=v+"/_api/web/lists/getByTitle('"+e+"')/Items("+t+")?";return o(r,n)},updateHostList:function(e){var t=b+"web/lists/getByTitle('"+e.Title+"')?"+w;return s(t,e)},updateHostListItem:function(e,t){var n=b+"web/lists/getByTitle('"+e+"')/Items("+t.Id+")?"+w;return s(n,t)},updateAppListItem:function(e,t){var n=v+"/_api/web/lists/getByTitle('"+e+"')/Items("+t.Id+")?";return s(n,t)},updateHostListField:function(e,t){var n=b+"web/lists/getByTitle('"+e+"')/Fields(guid'"+t.Id+"')?"+w;return s(n,t)},updateAppListField:function(e,t){var n=v+"/_api/web/lists/getByTitle('"+e+"')/Fields(guid'"+t.Id+"')?";return s(n,t)},addHostListField:function(e,t,n){var r=b+"web/lists(guid'"+e+"')/Fields?"+w;return L.addListField(r,t,n)},addAppListField:function(e,t,n){var r=v+"/_api/web/lists(guid'"+e+"')/Fields?";return L.addListField(r,t,n)},getCurrentUser:function(){var e=b+"/web/CurrentUser?"+w;return t(e)},getHostFile:function(e){var t=b+"web/GetFileByServerRelativeUrl('"+e+"')/$value?"+w;return n(t)},getAppFile:function(e){var t=v+"/_api/web/GetFileByServerRelativeUrl('"+e+"')/$value?";return n(t)},getHostFolderFiles:function(e){var n=b+"web/GetFolderByServerRelativeUrl('"+e+"')/Files?"+w;return t(n)},getHostFolderFolders:function(e){var n=b+"web/GetFolderByServerRelativeUrl('"+e+"')/Folders?"+w;return t(n)},addHostFolder:function(e,t){var n=b+"web/folders?"+w,t=e+"/"+t,r={__metadata:{type:"SP.Folder"},ServerRelativeUrl:t};return i(n,r)},addHostFile:function(e,t,n){var i=b+"web/GetFolderByServerRelativeUrl('"+e+"')/Files/Add(url='"+t+"',overwrite=true)?"+w;return r(i,n)},addAppFile:function(e,t,n){var i=v+"/_api/web/GetFolderByServerRelativeUrl('"+e+"')/Files/Add(url='"+t+"',overwrite=true)?";return r(i,n)},getHostListItemAttachments:function(e,n){var r=b+"web/lists/getByTitle('"+e+"')/Items("+n+")/AttachmentFiles?"+w;return t(r)},addHostListItemAttachment:function(e,t,n,r){var i=b+"web/lists/getByTitle('"+e+"')/Items("+t+")/AttachmentFiles/add(FileName='"+n+"')?"+w;return a(i,r)},getSiteUsers:function(e){var n=b+"web/SiteUsers?"+c(e)+w;return t(n)},breakRoleInheritanceOfHostList:function(e){var t=new $.Deferred,n=b+"web/lists/getByTitle('"+e+"')/breakroleinheritance(true)?"+w;return y.executeAsync({url:n,method:"POST",headers:{Accept:"application/json;odata=verbose"},success:t.resolve,error:t.reject}),t.promise()},breakRoleInheritanceOfAppList:function(e){var t=new $.Deferred,n=v+"/_api/web/lists/getByTitle('"+e+"')/breakroleinheritance(true)?";return y.executeAsync({url:n,method:"POST",headers:{Accept:"application/json;odata=verbose"},success:t.resolve,error:t.reject}),t.promise()},givePermissionToGroupToAppList:function(e,n,r){var i;return this.breakRoleInheritanceOfAppList(e).then(function(){var e=v+"/_api/web/sitegroups/getByName('"+r+"')?$select=Id";return t(e)}).then(function(t){var n;return i=t.d.Id,n=v+"/_api/web/lists/getbytitle('"+e+"')/roleassignments/getbyprincipalid('"+i+"')",o(n)}).then(function(){var e=v+"/_api/web/roledefinitions/getByName('"+n+"')?select=Id";return t(e)}).done(function(t){var n=v+"/_api/web/lists/getbytitle('"+e+"')/roleassignments/addroleassignment(principalid="+i+",roledefid="+t.d.Id+")",r=new $.Deferred;return y.executeAsync({url:n,method:"POST",headers:{Accept:"application/json;odata=verbose"},success:r.resolve,error:r.reject}),r.promise()})},getHostListRoleAssigmnent:function(e,n){var r=b+"web/lists/getbytitle('"+e+"')/roleassignments/getbyprincipalid('"+n+"')?"+w;return t(r)}},jsom:{checkHostList:function(e){var t=u();return S.checkList(t,e)},checkAppList:function(e){var t=l();return S.checkList(t,e)},getHostList:function(e){var t=u();return S.getList(t,e)},getAppList:function(e){var t=l();return S.getList(t,e)},deleteHostList:function(e){var t=u();return S.deleteList(t,e)},deleteAppList:function(e){var t=l();return S.deleteList(t,e)},getAppListPermissions:function(e,t){var n=l();return S.getListPermissions(n,e,t)},getHostListItems:function(e,t){var n=u();return S.getItems(n,e,t)},getAppListItems:function(e,t){var n=l();return S.getItems(n,e,t)},addHostListItem:function(e,t){var n=u();return S.addListItem(n,e,t)},addAppListItem:function(e,t){var n=l();return S.addListItem(n,e,t)},updateAppListItem:function(e,t,n){var r=l();return S.updateListItem(r,e,t,n)},updateHostListItem:function(e,t,n){var r=u();return S.updateListItem(r,e,t,n)},removeHostRecentElemByTitle:function(e){var t=u();return S.removeRecentElemByTitle(t,e)},removeAppRecentElemByTitle:function(e){var t=l();return S.removeRecentElemByTitle(t,e)},createHostList:function(e){var t=u();return S.createList(t,e)},createAppList:function(e){var t=l();return S.createList(t,e)},createHostSite:function(e){function t(){var e=o.get_title()+" created.";alert(e)}function n(e,t){alert("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())}var r,i,o;r=appContextSite.get_web(),i=new SP.WebCreationInformation,i.set_title(e.Title),i.set_webTemplate(e.Template),i.set_url(e.Url),i.set_language(e.language),i.set_useSamePermissionsAsParentSite(e.inheritPerms),o=r.get_webs().add(i),context.load(o),context.executeQueryAsync(t,n)}},utils:{urlParamsObj:d,buildQueryString:f,say:x,getRegionalSettings:function(e){var n=b+"/web/RegionalSettings?"+c(e)+w;return t(n)},getAppUrl:function(){return v},getHostUrl:function(){return g}},version:function(){x("Hello, spyreqs ver "+A)}},e.spyreqs=p(T,["rest","jsom","utils"])}(window);
//# sourceMappingURL=spyreqs.min.js.map