(function(n){"use strict";function f(n){var t=new $.Deferred;return o.executeAsync({url:n,method:"GET",dataType:"json",headers:{Accept:"application/json;odata=verbose"},success:function(n){t.resolve(JSON.parse(n.body))},fail:function(n){t.reject(n)}}),t.promise()}function g(n){var t=new $.Deferred;return o.executeAsync({url:n,method:"GET",success:function(n){t.resolve(n.body)},fail:function(n){t.reject(n)}}),t.promise()}function nt(n,t){var i=new $.Deferred;return o.executeAsync({url:n,method:"POST",headers:{Accept:"application/json; odata=verbose"},contentType:"application/json;odata=verbose",body:t,success:function(n){i.resolve(JSON.parse(n.body))},fail:function(n){i.reject(n)}}),i.promise()}function rt(n,t){var i=new $.Deferred;return o.executeAsync({url:n,method:"POST",headers:{ACCEPT:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose"},contentType:"application/json;odata=verbose",body:JSON.stringify(t),success:function(n){i.resolve(JSON.parse(n.body))},fail:function(n){i.reject(n)}}),i.promise()}function k(n,t){var i=new $.Deferred;return o.executeAsync({url:n,method:"POST",headers:{Accept:"application/json;odata=verbose","X-HTTP-Method":"DELETE","If-Match":t?t:"*"},success:function(n){i.resolve(n)},fail:function(n){i.reject(n)}}),i.promise()}function p(n,t){var i=new $.Deferred;return o.executeAsync({url:n,method:"POST",body:JSON.stringify(t),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-HTTP-Method":"MERGE","If-Match":t.__metadata&&t.__metadata.etag?t.__metadata.etag:"*"},success:function(n){i.resolve(n)},fail:function(n){i.reject(n)}}),i.promise()}function w(n,t){var i=new $.Deferred;return o.executeAsync({url:n,method:"POST",body:JSON.stringify(t),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose"},success:function(n){i.resolve(JSON.parse(n.body))},fail:function(n){i.reject(n)}}),i.promise()}function s(n){return typeof n=="undefined"||typeof n!="string"&&!(n instanceof String)?"":n}function c(){var n={},i,r,u;return SP.ClientContext?(i=new SP.ClientContext(t),r=new SP.ProxyWebRequestExecutorFactory(t),i.set_webRequestExecutorFactory(r),u=new SP.AppContextSite(i,l),n.context=i,n.factory=r,n.appContextSite=u,n):(e("SP.ClientContext not loaded"),null)}function h(){var n={},i;return SP.ClientContext?(i=new SP.ClientContext(t),n.context=i,n.appContextSite=i,n):(e("SP.ClientContext not loaded"),null)}function tt(){if(n.location.search){for(var r=document.location.search.substring(1).split("&"),f=r.length,u={},t=0,i;t<f;t++)i=r[t].toString().split("="),u[i[0]]=i[1];return u}return{}}function ut(n,t,i){var e=n.indexOf("?"),f,o,r,s;if(e>-1){var h=n.substring(e+1).split("&"),u={},c=h.length;for(f=0;f<c;f++)o=h[f].toString().split("="),u[o[0]]=o[1];u[t]=i;r="?";for(s in u)r+=s+"="+u[s]+"&";return r=r.substr(0,r.length-1),String(n.substr(0,e)+r)}return String(n+"?"+t+"="+i)}function ft(n,t){var i,r;return t.forEach(function(t){i=Object.keys(n[t]);i.forEach(function(i){i.indexOf("App")!==-1&&(r=i.replace("App","Web"),n[t][r]=n[t][i])})}),n}var t,l,a,o,i,r,v=0,e,y,u,b,it="0.0.8",d;e=typeof n.console!="undefined"?function(t){n.console.log(t)}:typeof n.top!="undefined"&&typeof n.top.console!="undefined"?function(t){n.top.console.log(t)}:typeof n.opener!="undefined"&&typeof n.opener.console!="undefined"?function(t){n.opener.console.log(t)}:function(){};a=tt();typeof a.SPAppWebUrl!="undefined"?(t=decodeURIComponent(a.SPAppWebUrl),t.indexOf("#")!==-1&&(t=t.split("#")[0])):v++;typeof a.SPHostUrl!="undefined"?(l=decodeURIComponent(a.SPHostUrl),r="&@target='"+l+"'",i=t+"/_api/SP.AppContextSite(@target)/",o=new SP.RequestExecutor(t)):v++;v==2?(d=n.location.href,t=l=d.substring(0,d.indexOf("/Pages")),$.getScript(l+"/_layouts/15/SP.RequestExecutor.js").done(function(){e("loaded: RequestExecutor.js");o=new SP.RequestExecutor(l)}).fail(function(){e("could not load: RequestExecutor.js")}),SP.ClientContext?e("sp.js is already loaded"):SP.SOD.executeFunc("sp.js","SP.ClientContext.get_current",function(){e("loaded: sp.js")})):v==1&&e("query param (SPHostUrl or SPAppWebUrl) is misssing");y={createList:function(n,t){var i={__metadata:{type:"SP.List"},BaseTemplate:t.Template,Title:t.Title};return w(n,i)},addListField:function(n,t,i){return t.__metadata={type:typeof i!="undefined"?i:"SP.Field"},w(n,t)}};u={createListFields:function(n,t,i){function e(){var i,h,e;if(typeof u=="undefined"&&(u=new $.Deferred),typeof r.Type=="undefined"&&(r.Type="Text"),typeof r.DisplayName=="undefined"&&(r.DisplayName=r.Name),r.Type!=="Lookup"){i="<Field ";for(e in r)e!=="choices"&&(i+=e+'="'+r[e]+'" ');if(i+=">",r.Type==="Choice"){i+="<CHOICES>";for(h in r.choices)i+="<CHOICE>"+r.choices[h]+"<\/CHOICE>";i+="<\/CHOICES>"}i+="<\/Field>"}else i+="";f=t.get_fields().addFieldAsXml(i,!0,SP.AddFieldOptions.defaultValue);n.load(t);n.executeQueryAsync(o,s)}function o(){i.length>0?(r=i.shift(),e()):u.resolve(f)}function s(n,t){var i={sender:n,args:t};u.reject(i)}var r,u,f;return r=i.shift(),e(),u.promise()},createList:function(n,t){function p(){t.fields?$.when(u.createListFields(n.context,o,t.fields)).then(function(){f.resolve(t)},function(n){f.reject(n)}):f.resolve(t)}function v(n,t){var i={sender:n,args:t};f.reject(i)}var c,o,r,l,f=new $.Deferred,h,s,y=["contentTypesEnabled","defaultContentApprovalWorkflowId","defaultDisplayFormUrl","defaultEditFormUrl","defaultNewFormUrl","documentTemplateUrl","draftVersionVisibility","enableAttachments","enableFolderCreation","enableMinorVersions","enableModeration","enableVersioning","forceCheckout","hidden","isApplicationList","isSiteAssetsLibrary","multipleDataList","noCrawl","onQuickLaunch","validationFormula","validationMessage","direction"],a,i;if(c=n.appContextSite.get_web(),r=new SP.ListCreationInformation,typeof t.title=="undefined")return e("createList cannot create without .title"),a={get_message:function(){return"createList cannot create without .title"},get_stackTrace:function(){return null}},setTimeout(v(null,a),500),f.promise();r.set_title(t.title);l=typeof t.template=="undefined"?SP.ListTemplateType.genericList:isNaN(t.template)?SP.ListTemplateType[t.template]:t.template;r.set_templateType(l);for(i in t)h=t[i],s="set_"+i,typeof r[s]=="function"&&r[s](h);o=c.get_lists().add(r);for(i in t)h=t[i],s="set_"+i,y.indexOf(i)>-1&&o[s](h);return o.update(),n.context.load(o),n.context.executeQueryAsync(p,v),f.promise()},addListItem:function(n,t,i){function h(){f.resolve(r.get_id())}function c(n,t){var i={sender:n,args:t};f.reject(i)}var e,o,r,u,s,f=new $.Deferred;e=n.appContextSite.get_web();o=e.get_lists().getByTitle(t);s=new SP.ListItemCreationInformation;r=o.addItem(s);for(u in i)r.set_item(u,i[u]);return r.update(),n.context.load(r),n.context.executeQueryAsync(h,c),f.promise()},getItems:function(n,t,i){function s(){u.resolve(r)}function h(n,t){var i={sender:n,args:t};u.reject(i)}var e,o,r,u=new $.Deferred,f;return e=n.appContextSite.get_web(),o=e.get_lists().getByTitle(t),f=new SP.CamlQuery,f.set_viewXml(i),r=o.getItems(f),n.context.load(r),n.context.executeQueryAsync(s,h),u.promise()},updateListItem:function(n,t,i,r){function h(){e.resolve(r)}function c(n,t){var i={sender:n,args:t};e.reject(i)}var o,s,u,f,r,e=new $.Deferred;o=n.appContextSite.get_web();s=o.get_lists().getByTitle(t);u=s.getItemById(r);for(f in i)u.set_item(f,i[f]);return u.update(),n.context.load(u),n.context.executeQueryAsync(h,c),e.promise()},checkList:function(n,t){function s(){for(var n=!1,u=r.getEnumerator(),f;u.moveNext();)if(f=u.get_current(),f.get_title()==t){n=!0;break}e(n);i.resolve(n)}function o(n,t){var r={sender:n,args:t};i.reject(r)}var u,r,i=new $.Deferred,f;return n?(u=n.appContextSite.get_web(),r=u.get_lists(),n.context.load(r,"Include(Title)"),n.context.executeQueryAsync(s,o),i.promise()):(f={get_message:function(){return"SP.ClientContext not loaded"},get_stackTrace:function(){return null}},setTimeout(o(null,f),500),i.promise())},removeRecentElemByTitle:function(n,t){function f(){var n="element removed from Recent: "+t;u.resolve(n)}function i(n,t){var i={sender:n,args:t};u.reject(i)}try{var r=n.appContextSite.get_web().get_navigation().get_quickLaunch(),u=new $.Deferred;return n.context.load(r),n.context.executeQueryAsync(function(){for(var s=r.getEnumerator(),u,o;s.moveNext();)u=s.get_current(),u.get_title()=="Recent"&&(o=u.get_children(),n.context.load(o),n.context.executeQueryAsync(function(){for(var s=o.getEnumerator(),u,h=!1,c;s.moveNext();)if(u=s.get_current(),u.get_title()==t){h=!0;u.deleteObject();n.context.load(r);n.context.executeQueryAsync(f,i);break}h||(e("Recent Element not found: "+t),c={get_message:function(){return"Element was not found"},get_stackTrace:function(){return null}},setTimeout(i(null,c),500))},i))},i),u.promise()}catch(o){return e(o.message),!1}},getList:function(n,t){function f(){r.resolve(i)}function e(n,t){var i={sender:n,args:t};r.reject(i)}var u,i,r=new $.Deferred;return u=n.appContextSite.get_web(),i=u.get_lists().getByTitle(t),n.context.load(i),n.context.executeQueryAsync(f,e),r.promise()},deleteList:function(n,t){function f(){i.resolve(t+" deleted")}function e(n,t){var r={sender:n,args:t};i.reject(r)}var r,u,i=new $.Deferred;return r=n.appContextSite.get_web(),u=r.get_lists().getByTitle(t),u.deleteObject(),n.context.executeQueryAsync(f,e),i.promise()},getListPermissions:function(n,t,i){function o(){u.resolve(e)}function s(n,t){var i={sender:n,args:t};u.reject(i)}var f,r,e,u=new $.Deferred;return f=n.appContextSite.get_web(),r=f.get_lists().getByTitle(t),e=r.getUserEffectivePermissions(i),n.context.load(r,"EffectiveBasePermissions"),n.context.executeQueryAsync(o,s),u.promise()}};b={rest:{getHostLists:function(n){var t=i+"web/lists?"+s(n)+r;return f(t)},getAppLists:function(n){var i=t+"/_api/web/lists?"+s(n);return f(i)},getHostListByTitle:function(n,t){var u=i+"web/lists/getByTitle('"+n+"')?"+s(t)+r;return f(u)},getAppListByTitle:function(n,i){var r=t+"/_api/web/lists/getByTitle('"+n+"')?"+s(i);return f(r)},getHostListItems:function(n,t){var u=i+"web/lists/getByTitle('"+n+"')/Items?"+s(t)+r;return f(u)},getAppListItems:function(n,i){var r=t+"/_api/web/lists/getByTitle('"+n+"')/Items?"+s(i);return f(r)},getHostListFields:function(n,t){var u=i+"web/lists/getByTitle('"+n+"')/Fields?"+s(t)+r;return f(u)},getAppListFields:function(n,i){var r=t+"/_api/web/lists/getByTitle('"+n+"')/Fields?"+s(i);return f(r)},createHostList:function(n){var t=i+"web/lists?"+r;return y.createList(t,n)},createAppList:function(n){var i=t+"/_api/web/lists?";return y.createList(i,n)},addHostListItem:function(n,t){var u=i+"web/lists/getByTitle('"+n+"')/Items?"+r;return w(u,t)},addAppListItem:function(n,i){var r=t+"/_api/web/lists/getByTitle('"+n+"')/Items?";return w(r,i)},deleteHostListItem:function(n,t,u){var f=i+"web/lists/getByTitle('"+n+"')/Items("+t+")?"+r;return k(f,u)},deleteAppListItem:function(n,i,r){var u=t+"/_api/web/lists/getByTitle('"+n+"')/Items("+i+")?";return k(u,r)},updateHostList:function(n){var t=i+"web/lists/getByTitle('"+n.Title+"')?"+r;return p(t,n)},updateHostListItem:function(n,t){var u=i+"web/lists/getByTitle('"+n+"')/Items("+t.Id+")?"+r;return p(u,t)},updateAppListItem:function(n,i){var r=t+"/_api/web/lists/getByTitle('"+n+"')/Items("+i.Id+")?";return p(r,i)},updateHostListField:function(n,t){var u=i+"web/lists/getByTitle('"+n+"')/Fields(guid'"+t.Id+"')?"+r;return p(u,t)},updateAppListField:function(n,i){var r=t+"/_api/web/lists/getByTitle('"+n+"')/Fields(guid'"+i.Id+"')?";return p(r,i)},addHostListField:function(n,t,u){var f=i+"web/lists(guid'"+n+"')/Fields?"+r;return y.addListField(f,t,u)},addAppListField:function(n,i,r){var u=t+"/_api/web/lists(guid'"+n+"')/Fields?";return y.addListField(u,i,r)},getCurrentUser:function(){var n=i+"/web/CurrentUser?"+r;return f(n)},getHostFile:function(n){var t=i+"web/GetFileByServerRelativeUrl('"+n+"')/$value?"+r;return g(t)},getAppFile:function(n){var i=t+"/_api/web/GetFileByServerRelativeUrl('"+n+"')/$value?";return g(i)},getHostFolderFiles:function(n){var t=i+"web/GetFolderByServerRelativeUrl('"+n+"')/Files?"+r;return f(t)},getHostFolderFolders:function(n){var t=i+"web/GetFolderByServerRelativeUrl('"+n+"')/Folders?"+r;return f(t)},addHostFolder:function(n,t){var u=i+"web/folders?"+r,t=n+"/"+t,f={__metadata:{type:"SP.Folder"},ServerRelativeUrl:t};return rt(u,f)},addHostFile:function(n,t,u){var f=i+"web/GetFolderByServerRelativeUrl('"+n+"')/Files/Add(url='"+t+"',overwrite=true)?"+r;return nt(f,u)},addAppFile:function(n,i,r){var u=t+"/_api/web/GetFolderByServerRelativeUrl('"+n+"')/Files/Add(url='"+i+"',overwrite=true)?";return nt(u,r)},getHostListItemAttachments:function(n,t){var u=i+"web/lists/getByTitle('"+n+"')/Items("+t+")/AttachmentFiles?"+r;return f(u)},addHostListItemAttachment:function(n,t,u,f){var e=i+"web/lists/getByTitle('"+n+"')/Items("+t+")/AttachmentFiles/add(FileName='"+u+"')?"+r;return w(e,f)},getSiteUsers:function(n){var t=i+"web/SiteUsers?"+s(n)+r;return f(t)},breakRoleInheritanceOfHostList:function(n){var t=new $.Deferred,u=i+"web/lists/getByTitle('"+n+"')/breakroleinheritance(true)?"+r;return o.executeAsync({url:u,method:"POST",headers:{Accept:"application/json;odata=verbose"},success:t.resolve,error:t.reject}),t.promise()},breakRoleInheritanceOfAppList:function(n){var i=new $.Deferred,r=t+"/_api/web/lists/getByTitle('"+n+"')/breakroleinheritance(true)?";return o.executeAsync({url:r,method:"POST",headers:{Accept:"application/json;odata=verbose"},success:i.resolve,error:i.reject}),i.promise()},givePermissionToGroupToAppList:function(n,i,r){var u;return this.breakRoleInheritanceOfAppList(n).then(function(){var n=t+"/_api/web/sitegroups/getByName('"+r+"')?$select=Id";return f(n)}).then(function(i){var r;return u=i.d.Id,r=t+"/_api/web/lists/getbytitle('"+n+"')/roleassignments/getbyprincipalid('"+u+"')",k(r)}).then(function(){var n=t+"/_api/web/roledefinitions/getByName('"+i+"')?select=Id";return f(n)}).done(function(i){var f=t+"/_api/web/lists/getbytitle('"+n+"')/roleassignments/addroleassignment(principalid="+u+",roledefid="+i.d.Id+")",r=new $.Deferred;return o.executeAsync({url:f,method:"POST",headers:{Accept:"application/json;odata=verbose"},success:r.resolve,error:r.reject}),r.promise()})},getHostListRoleAssigmnent:function(n,t){var u=i+"web/lists/getbytitle('"+n+"')/roleassignments/getbyprincipalid('"+t+"')?"+r;return f(u)}},jsom:{checkHostList:function(n){var t=c();return u.checkList(t,n)},checkAppList:function(n){var t=h();return u.checkList(t,n)},getHostList:function(n){var t=c();return u.getList(t,n)},getAppList:function(n){var t=h();return u.getList(t,n)},deleteHostList:function(n){var t=c();return u.deleteList(t,n)},deleteAppList:function(n){var t=h();return u.deleteList(t,n)},getAppListPermissions:function(n,t){var i=h();return u.getListPermissions(i,n,t)},getHostListItems:function(n,t){var i=c();return u.getItems(i,n,t)},getAppListItems:function(n,t){var i=h();return u.getItems(i,n,t)},addHostListItem:function(n,t){var i=c();return u.addListItem(i,n,t)},addAppListItem:function(n,t){var i=h();return u.addListItem(i,n,t)},updateAppListItem:function(n,t,i){var r=h();return u.updateListItem(r,n,t,i)},updateHostListItem:function(n,t,i){var r=c();return u.updateListItem(r,n,t,i)},removeHostRecentElemByTitle:function(n){var t=c();return u.removeRecentElemByTitle(t,n)},removeAppRecentElemByTitle:function(n){var t=h();return u.removeRecentElemByTitle(t,n)},createHostList:function(n){var t=c();return u.createList(t,n)},createAppList:function(n){var t=h();return u.createList(t,n)},createHostSite:function(n){function u(){var n=i.get_title()+" created.";alert(n)}function f(n,t){alert("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())}var r,t,i;r=appContextSite.get_web();t=new SP.WebCreationInformation;t.set_title(n.Title);t.set_webTemplate(n.Template);t.set_url(n.Url);t.set_language(n.language);t.set_useSamePermissionsAsParentSite(n.inheritPerms);i=r.get_webs().add(t);context.load(i);context.executeQueryAsync(u,f)}},utils:{urlParamsObj:tt,buildQueryString:ut,say:e,getRegionalSettings:function(n){var t=i+"/web/RegionalSettings?"+s(n)+r;return f(t)},getAppUrl:function(){return t},getHostUrl:function(){return l}},version:function(){e("Hello, spyreqs ver "+it)}};n.spyreqs=v!=2?ft(b,["rest","jsom","utils"]):b})(window);
/*
//# sourceMappingURL=spyreqs.min.js.map
*/